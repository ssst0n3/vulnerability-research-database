package vrdb

import (
	"github.com/ssst0n3/vulnerability-research-database/model/osv"
	"gorm.io/gorm"
)

type Exploit struct {
	gorm.Model
	Credits         []Credit `json:"credit" gorm:"many2many:exploit_credits;"`
	Name            string   `json:"name"`
	Url             string   `json:"url"`
	VulnerabilityID uint     `json:"vulnerability_id"`
}

func (x Exploit) OSV() *osv.Exploit {
	var credits []osv.Credit
	for _, credit := range x.Credits {
		credits = append(credits, *credit.OSV())
	}
	return &osv.Exploit{
		Credits: credits,
		Name:    x.Name,
		Url:     x.Url,
	}
}

func NewExploit(o osv.Exploit) *Exploit {
	return &Exploit{
		Credits: NewCredits(o.Credits),
		Name:    o.Name,
		Url:     o.Url,
	}
}
func NewExploits(o []osv.Exploit) (exploits []Exploit) {
	for _, exploit := range o {
		exploits = append(exploits, *NewExploit(exploit))
	}
	return
}
