package vrdb

import (
	"github.com/ssst0n3/vulnerability-research-database/model/osv"
	"github.com/ssst0n3/vulnerability-research-database/model/osv/type/env"
	"gorm.io/gorm"
)

type Environment struct {
	gorm.Model
	Credits         []Credit `json:"credits"`
	Type            env.Type `json:"type"`
	Image           string   `json:"image"`
	Usage           string   `json:"usage"`
	Url             string   `json:"url"`
	VulnerabilityID uint     `json:"vulnerability_id"`
}

func (e Environment) OSV() *osv.Environment {
	var credits []osv.Credit
	for _, credit := range e.Credits {
		credits = append(credits, *credit.OSV())
	}
	return &osv.Environment{
		Credits: credits,
		Type:    e.Type,
		Image:   e.Image,
		Usage:   e.Usage,
		Url:     e.Url,
	}
}

func NewEnvironment(o osv.Environment) *Environment {
	return &Environment{
		Credits: NewCredits(o.Credits),
		Type:    o.Type,
		Image:   o.Image,
		Usage:   o.Usage,
		Url:     o.Url,
	}
}
